@using DiyetisyenGultenManav.Entities.ValueObjects
@model HomeViewModel
@{
    ViewBag.Title = "AnaSayfa";
}
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />
<style>
    .kücükResim {
        max-height: 256px;
        width: 100%;
        height: 100%;
    }
</style>
<div class="row m-3 ">
    <div class="col-md-2">
        @Html.Partial("_PartialKategoriler")

    </div>
    <div class="col-md-10">
        @Html.Partial("_PartialCarousel")
        <!--Blog-->
        <div class="row row row-cols-1 row-cols-md-3 ">
            @{
                int i = 0;
            }
            @foreach (var blogYazısı in Model.BlogYazısı)
            {
                i++;
                <div class="col mb-4">
                    <div class="card ">
                        <img src="~/ImageBlog/@blogYazısı.Picture" class="card-img-top kücükResim" alt="@blogYazısı.Title">
                        <div class="card-body">
                            @*<h5 class="card-title">
                                    <a href="#" data-target="#modal_notedetail" data-toggle="modal"
                                       data-note-id="@note.Id"> @note.Title</a>
                                </h5>*@
                            <p class="card-text">
                                @if (string.IsNullOrEmpty(blogYazısı.ParagrafBir) == false && blogYazısı.ParagrafBir.Length > 60)
                                {
                                    @(blogYazısı.ParagrafBir.Substring(0, 60) + "...")
                                }
                                else
                                {
                                    @blogYazısı.ParagrafBir
                                }
                            </p>
                            <p class="card-text text-right">
                                <small class="text-muted">
                                    <i class="fa fa-user mr-2"></i>@blogYazısı.Owner.Username<br />
                                    <i class="fa fa-clock-o mr-2"></i>@blogYazısı.ModifiedOn.ToString("dd.MM.yy HH:mm")
                                </small>
                            </p>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="ratings">
                                        @*<button class="btn btn-default btn-sm" type="button" data-liked="false" data-note-id="@blogYazısı.Id">
                                                <i class="fa fa-star-o like-star mr-1"></i>&nbsp;
                                                <span class="like-count">@blogYazısı.LikeCount</span>
                                            </button>*@
                                        <button class="btn btn-default btn-sm " data-toggle="modal"
                                                data-target="#modal_comment" data-blog-id="@blogYazısı.Id">
                                            <i class="fa fa-comment mr-1" style="color: #3498db;"></i>
                                            <span style="color: #3498db;">@blogYazısı.Yorumlar.Count</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6 text-right">
                                    @Bootstrap.LinkButton("/Home/BlogYazisiDetails/" + blogYazısı.Id, "outline-info", "btn-sm", "Details", string.Empty, "Detay")
                                </div>
                                @*<div class="col-md-6 text-right">
                                        <a href="#" data-toggle="modal" data-target="#modal_notedetail"
                                           data-note-id="@blogYazısı.Id" class="btn btn-default">Detay <i class="fa fa-info-circle ml-2"></i></a>
                                    </div>*@
                            </div>
                        </div>
                    </div>
                </div>
                if (i == 9)
                {
                    break;
                }
            }

        </div>
    </div>
</div>

@section princing{
    @Html.Partial("_PartialPrincing")
}
@section stat{
    @Html.Partial("_PartialKahve")
}
@section map{
    @Html.Partial("_PartialMap")
}
@section footer{
    @Html.Partial("_PartialFooter")
}
@Bootstrap.ModalPopup(id: "modal_comment", title: "Yorumlar")
<script>
    $(function () {
        var noteid = -1;
        var modalCommentBodyId = "#modal_comment_body";
        $('#modal_comment').on('show.bs.modal', function (e) {
            var btn = $(e.relatedTarget);
            noteid = btn.data("blog-id");
            $(modalCommentBodyId).load("/Yorum/ShowNoteComments/" + noteid);
        });
    });
    function doYorum(btn, e, yorumid, spanid) {
        var button = $(btn);
        var mode = button.data("edit-mode");
        if (e == "edit_clicked") {
            if (!mode) {
                button.data("edit-mode", true);
                button.removeClass("btn-warning");
                button.addClass("btn-success");
                var btnSpan = button.find("span")
                btnSpan.removeClass("fa-edit");
                btnSpan.addClass("fa-check");
                $(spanid).addClass("editable");
                $(spanid).attr("contenteditable", true);
                $(spanid).focus();
            }
            else {
                button.data("edit-mode", false);
                button.addClass("btn-warning");
                button.removeClass("btn-success");
                var btnSpan = button.find("span")
                btnSpan.addClass("fa-edit");
                btnSpan.removeClass("fa-check");
                $(spanid).removeClass("editable");
                $(spanid).attr("contenteditable", false);
                var txt = $(spanid).text();
                $.ajax({
                    method: "POST",
                    url: "/Yorum/Edit/" + yorumid,
                    data: { text: txt }
                }).done(function (data) {

                    if (data.result) {
                        // yorumlar partial tekrar yüklenir
                        $(modalCommentBodyId).load("/Yorum/ShowNoteComments/" + noteid);

                    } else {
                        alert("Yorum Güncellenemedi");
                    }
                }).fail(function () {
                    alert("Sunucu ile Bağlantı kurulamadı.");
                });
            }
        }
        else if (e == "delete_clicked") {
            var dialog_result = confirm("Yorum Silinsin mi ? ");
            if (!dialog_result) return false;
            $.ajax({
                method: "GET",
                url: "/Yorum/Delete/" + yorumid
            }).done(function (data) {

                if (data.result) {
                    // yorumlar partial tekrar yüklenir
                    $(modalCommentBodyId).load("/Yorum/ShowNoteComments/" + noteid);
                } else {
                    alert("Yorum Silinemedi");
                }
            }).fail(function () {
                alert("Sunucu İle bağlantı kurulamadı.");
            });
        }
    }
</script>